## Overview

Adds Stripe-based payments, commissions, and doctor payouts: Prisma schema, shared types, Stripe config and utilities, and payment/commission services. No API routes or UI yet.

## What's Included

### Database & types

- **Prisma schema**
  - `Payment` (appointmentId, patientId, doctorId, amount, status, stripe ids, refunds)
  - `Commission` (paymentId, appointmentId, doctorId, amounts, status, stripeTransferId)
  - `DoctorCommissionSettings` (doctorId, commissionRate, appointmentPrice)
  - `Doctor.stripeAccountId` for Connect payouts
  - `Appointment.paymentId`, `User.patientPayments`, `Appointment.commissions`
- **@medbook/types**
  - `commission.types.ts`: CommissionStatus, Commission, DoctorCommissionSettings, CreateCommissionInput, CreateCommissionSettingsInput, UpdateCommissionSettingsInput, CommissionStats
  - `payment.types.ts`: PaymentStatus, Payment, CreatePaymentInput, CreatePaymentIntentInput, ConfirmPaymentInput, ProcessRefundInput, PaymentIntentResponse

### Stripe setup

- **Env** (`config/env.ts`): `STRIPE_SECRET_KEY`, `STRIPE_PUBLISHABLE_KEY`, `STRIPE_WEBHOOK_SECRET`
- **Config** (`config/stripe.ts`): `getStripeClient()`, `isStripeConfigured()`
- **Utils** (`utils/stripe.ts`):
  - Payment intents: `createPaymentIntent`, `confirmPaymentIntent`, `getPaymentIntent`
  - Refunds: `processRefund`, `processPartialRefund`
  - Connect: `createConnectedAccount`, `createTransfer`, `getCharge`

### Services

- **payment.service**
  - `createPaymentIntentForAppointment`, `createPayment`, `confirmPayment`, `processPaymentRefund`
  - `getPaymentByAppointmentId`, `getPaymentById`, `updatePaymentStatus`
- **commission.service**
  - `calculateCommission`, `getCommissionSettingsByDoctorId`, `getOrCreateCommissionSettings`
  - `createCommissionSettings`, `updateCommissionSettings`
  - `createCommission`, `getCommissionByPaymentId`, `getCommissionsByDoctorId`
  - `processPayout`, `cancelCommission`, `getCommissionStats`

## Next steps (out of scope)

- Run migration (for local/staging/prod): `pnpm db:migrate:deploy`
- Add API routes for payment intents, confirm, refunds, commission settings, payouts
- Add Stripe webhook handler for `payment_intent.succeeded` and related events
- Add UI for checkout, refunds, and admin commission/payout management

## Env

Set for local/Staging/Prod:

- `STRIPE_SECRET_KEY`
- `STRIPE_PUBLISHABLE_KEY` (for frontend)
- `STRIPE_WEBHOOK_SECRET` (when using webhooks)
